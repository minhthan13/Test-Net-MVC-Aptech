@using TestNetMVC.Services
@inject AccountService AccountService

@{

  var accounts = AccountService.FindAll();
  accounts.RemoveAll(x => x.Username == "admin");
  var i = 1;

}
<div class="card-header">
  <!--ADD NEW EMPLOYEE-->
  <button type="button" class="btn btn-info" data-toggle="modal" data-target="#AddNewEmployee">
    Add New Employee
  </button>
  <partial name="~/Areas/Shared/Modals/_AddNewEmployeeModal.cshtml" />
  <!--./// ADD NEW EMPLOYEE-->
  <!--search Box -->
  <div class="card-tools">
    <div class="input-group input-group-sm" style="width: 150px;">
      <input type="text" name="table_search" class="form-control float-right" placeholder="Search">

      <div class="input-group-append">
        <button type="submit" class="btn btn-default">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </div>
  <!-- End search Box -->

</div>
<div class="card-body table-responsive p-0">


  <table class="table table-hover text-nowrap text-center" id="tableEmployee">
    <thead>
      <tr>
        <th>#</th>
        <th>Username</th>
        <th>Fullname</th>
        <th>Date Of Birth</th>
        <th>Active</th>
        <th>Role</th>
        <th>Requests</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var a in accounts.OrderBy(a => a.Status))
      {

        <tr class="rowdata">
          <td>@(i++)</td>
          <td>@a.Username</td>
          <td>@a.Fullname</td>
          <td><span class="tag tag-success">@a.Dob.ToString("dd/MM/yyyy")</span></td>
          <td>
            <input type="checkbox" class="EmployeeActive" @(a.Status ? "checked" : "")
              data-employee-username="@a.Username">
          </td>
          @foreach (var role in a.Roles)
          {
            <td>@role.RoleName</td>
          }
          <td>
            <span class="employeeRequest" data-employee-username="@a.Username" data-toggle="modal"
              data-target="#EmployeeInfoModal" style="cursor: pointer;">
              <b> @a.RequestEmployeeIdSubmitNavigations.Count</b>
            </span>
          </td>
        </tr>

      }
    </tbody>
  </table>
</div>




<script>
  $(document).ready(function () {

    $('#tableEmployee .employeeRequest').click(function () {

      var employeeUsername = $(this).data('employee-username');
      $("#TitleModalUsername").html(employeeUsername);
      // Sử dụng Ajax để gửi employeeUsername 
      $.ajax({
        type: 'GET',
        url: '/ajax/ModalEmployeePartial',
        data: { username: employeeUsername },
        success: function (response) {
          $('#EmployeeInfoModal .modal-body').html(response);

        }
      });
    });
    $('#EmployeeInfoModal .close').click(function () {
      $('#EmployeeInfoModal .modal-body').empty();
    });
    // ========
    $('.EmployeeActive').change(function () {
      var isChecked = $(this).prop('checked');
      var username = $(this).data('employee-username');
      $.ajax({
        type: 'GET',
        url: '/ajax/ActiveAccount',
        data: { username, isChecked },
        success: function (res) {
          console.log(res);
        }
      });
    });
    // ========





  });
</script>
<!-- Modal -->


<div class="modal fade" id="EmployeeInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title " id="exampleModalLongTitle">
          request list of <b><i id="TitleModalUsername"></i></b> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- ajax response -->
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary" asp-area="Admin" asp-controller="Admin" asp-action="Employees">Save</a>

        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
